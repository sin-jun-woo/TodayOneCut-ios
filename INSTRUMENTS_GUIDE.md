# Instruments 메모리 누수 검사 가이드

## 📋 검사 목표
- 메모리 누수 확인
- 메모리 사용량 모니터링
- 반복 작업 시 메모리 증가 확인

---

## 🔧 Instruments 실행 방법

### 1. Instruments 실행
1. Xcode에서 프로젝트 열기
2. **Product > Profile** (`⌘I`) 실행
3. Instruments 창이 열림

### 2. Leaks 템플릿 선택
1. Instruments 창에서 **Leaks** 템플릿 선택
2. 또는 **Allocations** + **Leaks** 조합 선택 (더 상세한 분석)
3. **Choose** 클릭

### 3. 앱 실행 및 테스트
1. 시뮬레이터 또는 실제 기기 선택
2. **Record** 버튼 클릭 (빨간 원)
3. 앱이 자동으로 실행됨

---

## 🧪 테스트 시나리오

### 기본 기능 테스트
1. **앱 시작**
   - 앱 실행
   - 온보딩 화면 확인
   - 홈 화면으로 이동

2. **기록 작성**
   - 텍스트 기록 작성
   - 사진 기록 작성
   - 위치 정보 포함 기록 작성

3. **기록 조회**
   - 기록 목록 확인
   - 기록 상세 보기
   - 달력에서 기록 확인

4. **기록 수정/삭제**
   - 기록 수정
   - 기록 삭제

5. **검색 기능**
   - 검색어 입력
   - 검색 결과 확인
   - 검색 취소

6. **설정 변경**
   - 테마 변경
   - 폰트 변경
   - 위치 설정 변경

### 반복 작업 테스트 (중요!)
1. **기록 작성/삭제 반복**
   - 기록 작성 → 삭제 → 작성 → 삭제 (10회 반복)
   - 메모리 사용량 확인

2. **화면 전환 반복**
   - 홈 → 목록 → 달력 → 설정 (10회 반복)
   - 메모리 사용량 확인

3. **검색 반복**
   - 검색어 입력 → 결과 확인 → 검색 취소 (10회 반복)
   - 메모리 사용량 확인

4. **이미지 로딩 반복**
   - 사진 기록 작성 → 상세 보기 → 뒤로가기 (10회 반복)
   - 메모리 사용량 확인

---

## 📊 검사 결과 확인

### 1. Leaks 검사
- **빨간색 표시**: 메모리 누수 발견
- **노란색 표시**: 잠재적 메모리 누수
- **상세 정보**: 누수 발생 위치 확인

### 2. Allocations 검사
- **메모리 사용량 그래프**: 시간에 따른 메모리 사용량
- **카테고리별 메모리**: 객체 타입별 메모리 사용량
- **증가 추세**: 반복 작업 시 메모리 증가 확인

### 3. 확인 사항
- ✅ 메모리 누수 없음 (빨간색 표시 없음)
- ✅ 메모리 사용량 안정적 (급격한 증가 없음)
- ✅ 반복 작업 시 메모리 증가 없음
- ✅ 화면 전환 시 메모리 해제 확인

---

## 🔍 주요 확인 포인트

### 1. ViewModel 메모리
- 화면 전환 시 ViewModel 해제 확인
- Task 취소 확인
- Combine cancellables 정리 확인

### 2. 이미지 메모리
- 이미지 선택 후 해제 확인
- AsyncImage 메모리 사용량 확인
- 큰 이미지 처리 확인

### 3. Core Data 메모리
- Core Data context 메모리 사용량
- Fetch request 결과 메모리 해제

### 4. Location Manager 메모리
- 위치 요청 후 메모리 해제 확인
- CLLocationManager delegate 해제 확인

---

## 🐛 문제 발견 시

### 메모리 누수 발견
1. **누수 위치 확인**
   - Instruments에서 누수 발생 위치 확인
   - 스택 트레이스 확인

2. **원인 분석**
   - 강한 참조 순환 확인
   - Task 취소 누락 확인
   - 리소스 해제 누락 확인

3. **수정**
   - `[weak self]` 추가
   - Task 취소 처리 추가
   - `deinit`에서 리소스 정리

### 메모리 사용량 증가
1. **증가 원인 확인**
   - Allocations에서 증가하는 객체 타입 확인
   - 반복 작업 시 증가 패턴 확인

2. **최적화**
   - 불필요한 객체 생성 제거
   - 이미지 크기 최적화
   - 캐시 크기 제한

---

## 📝 검사 체크리스트

### 기본 검사
- [ ] Leaks 템플릿으로 메모리 누수 확인
- [ ] Allocations로 메모리 사용량 확인
- [ ] 기본 기능 테스트 중 메모리 확인

### 반복 작업 검사
- [ ] 기록 작성/삭제 반복 (10회)
- [ ] 화면 전환 반복 (10회)
- [ ] 검색 반복 (10회)
- [ ] 이미지 로딩 반복 (10회)

### 결과 확인
- [ ] 메모리 누수 없음 확인
- [ ] 메모리 사용량 안정적 확인
- [ ] 반복 작업 시 메모리 증가 없음 확인

---

## 💡 팁

1. **장시간 테스트**: 10-15분간 앱 사용하며 메모리 모니터링
2. **다양한 시나리오**: 다양한 기능 조합으로 테스트
3. **실제 기기 테스트**: 시뮬레이터와 실제 기기 모두 테스트
4. **메모리 경고 확인**: Xcode Console에서 메모리 경고 확인

---

## 🚀 다음 단계

검사 완료 후:
1. 발견된 문제 수정
2. 수정 후 재검사
3. 최종 검사 결과 문서화

---

**작성일**: 2025-01-XX  
**상태**: Instruments 검사 가이드 준비 완료

